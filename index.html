<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Fish ML | Dashboard</title>
  <style>
    :root {
      --bg: #f6f8fb;
      --panel: #ffffff;
      --panel-2: #f8fafc;
      --border: #e5e7eb;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #2563eb;
      --accent-2: #7c9cff;
      --accent-rgb: 37, 99, 235;
      --accent2-rgb: 124, 156, 255;
      --topbar-bg: rgba(255, 255, 255, 0.8);
      --topbar-text: #0f172a;
      --status-bg: rgba(37, 99, 235, 0.08);
    }

    body.brand-efish {
      --bg: #f6f8fb;
      --panel: #ffffff;
      --panel-2: #f8fafc;
      --border: #e5e7eb;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #2563eb;
      --accent-2: #7c9cff;
      --accent-rgb: 37, 99, 235;
      --accent2-rgb: 124, 156, 255;
      --topbar-bg: rgba(255, 255, 255, 0.8);
      --topbar-text: #0f172a;
      --status-bg: rgba(37, 99, 235, 0.08);
    }

    body.brand-duo {
      --bg: #ffffff;
      --panel: #ffffff;
      --panel-2: #ffffff;
      --border: #e5e7eb;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #e50914;
      --accent-2: #ffb3b9;
      --accent-rgb: 229, 9, 20;
      --accent2-rgb: 255, 179, 185;
      --topbar-bg: rgba(255, 255, 255, 0.8);
      --topbar-text: #0f172a;
      --status-bg: rgba(229, 9, 20, 0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 10% 20%, rgba(var(--accent-rgb), 0.08), transparent 34%), radial-gradient(circle at 80% 0%, rgba(var(--accent2-rgb), 0.12), transparent 30%), linear-gradient(180deg, var(--bg) 0%, var(--panel-2) 100%);
      display: flex;
    }

    .layout {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      box-shadow: 6px 0 24px rgba(15, 23, 42, 0.08);
    }

    body.brand-gate .sidebar {
      display: none;
    }

    body.brand-gate #switch-brand {
      display: none;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
    }

    .brand img {
      width: 52px;
      height: 52px;
      object-fit: contain;
      filter: drop-shadow(0 6px 12px rgba(15, 23, 42, 0.12));
    }

    .brand-title {
      display: block;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.01em;
      color: var(--topbar-text, var(--text));
    }

    .brand-sub {
      display: block;
      color: var(--topbar-text, var(--muted));
      font-size: 12px;
    }

    .menu {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding-top: 8px;
    }

    .menu-item {
      display: block;
      padding: 12px 14px;
      border-radius: 10px;
      color: var(--text);
      text-decoration: none;
      border: 1px solid transparent;
      background: transparent;
      font-weight: 600;
      transition: all 0.18s ease;
    }

    .menu-item:hover {
      border-color: var(--border);
      background: rgba(var(--accent-rgb), 0.06);
    }

    .menu-item.active {
      border-color: rgba(var(--accent-rgb), 0.35);
      background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.14), rgba(var(--accent2-rgb), 0.12));
      box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.15);
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--panel-2);
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--topbar-bg);
      backdrop-filter: blur(6px);
      color: var(--topbar-text, var(--text));
    }

    body:not(.brand-gate) #topbar-intro {
      display: none;
    }

    .topbar h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.01em;
      color: inherit;
    }

    .topbar p {
      margin: 4px 0 0 0;
      color: inherit;
      font-size: 13px;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--status-bg);
      font-size: 13px;
      color: var(--topbar-text, var(--text));
    }

    body.brand-duo .topbar {
      background: var(--topbar-bg);
      border-color: var(--border);
      color: var(--topbar-text, var(--text));
    }

    body.brand-duo .status-pill {
      border-color: var(--border);
    }

    .status-pill.online {
      border-color: rgba(34, 197, 94, 0.4);
      background: rgba(34, 197, 94, 0.14);
    }

    .status-pill.online .dot {
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.2);
    }

    body.brand-duo .sidebar {
      background: var(--panel);
      border-color: var(--border);
      box-shadow: 6px 0 24px rgba(15, 23, 42, 0.08);
    }

    body.brand-duo .menu-item {
      color: var(--text);
    }

    body.brand-duo .menu-item:hover {
      background: rgba(var(--accent-rgb), 0.06);
      border-color: var(--border);
    }

    body.brand-duo .menu-item.active {
      border-color: rgba(var(--accent-rgb), 0.35);
      background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.14), rgba(var(--accent2-rgb), 0.12));
      box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.15);
    }

    body.brand-duo .brand-sub,
    body.brand-duo .brand-title {
      color: var(--topbar-text, var(--text));
    }

    body.brand-duo .brand {
      padding-bottom: 0;
      border-bottom: none;
      justify-content: center;
    }

    body.brand-duo .brand img {
      width: 120px;
      height: auto;
      padding: 0;
      background: transparent;
      border: none;
      filter: drop-shadow(0 10px 24px rgba(15, 23, 42, 0.15));
    }

    body.brand-duo .brand-text {
      display: none;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(var(--accent-rgb), 0.18);
      animation: pulse 1.8s ease-in-out infinite;
    }

    .dot.offline {
      background: #ef4444;
      box-shadow: 0 0 0 6px rgba(239, 68, 68, 0.18);
    }

    @keyframes pulse {
      0% { transform: scale(0.95); opacity: 0.9; }
      50% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(0.95); opacity: 0.9; }
    }

    .board {
      flex: 1;
      padding: 24px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      overflow-y: auto;
    }

    .placeholder {
      width: 100%;
      min-height: 240px;
      border: 2px dashed var(--border);
      border-radius: 14px;
      display: grid;
      place-items: center;
      color: var(--muted);
      text-align: center;
      padding: 28px;
      background: var(--panel-2);
    }

    .board-card {
      max-width: 1120px;
      width: 100%;
      margin: 0 auto;
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(var(--accent-rgb), 0.3);
      background: rgba(var(--accent-rgb), 0.1);
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
      width: fit-content;
    }

    .cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(var(--accent-rgb), 0.18);
      background: rgba(var(--accent-rgb), 0.14);
    }

    .note {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .app-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 6px 0;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(var(--accent-rgb), 0.1);
      color: var(--text);
      font-size: 13px;
      box-shadow: 0 8px 24px rgba(var(--accent-rgb), 0.12);
    }

    .calc-grid {
      display: grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 16px;
    }

    .calc-extra {
      margin-top: 0;
    }

    .panel-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .panel-title {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      row-gap: 8px;
      margin-bottom: 0;
    }

    .panel-title .actions {
      gap: 8px;
      row-gap: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 10px;
      background: rgba(var(--accent-rgb), 0.12);
      border: 1px solid rgba(var(--accent-rgb), 0.3);
      color: var(--text);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel-2);
    }

    .field span {
      font-size: 13px;
      color: var(--muted);
    }

    .field input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: var(--panel);
      color: var(--text);
      font-size: 15px;
      outline: none;
      transition: border 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .field input:focus {
      border-color: rgba(var(--accent-rgb), 0.5);
      box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.18);
      background: #f8fafc;
    }

    .hint {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 12px;
      margin-bottom: 0;
    }

    .stat-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: var(--panel);
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 120px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    .stat-label {
      color: var(--muted);
      font-size: 13px;
      margin: 0;
    }

    .stat-value {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .value-positive { color: #4ade80; }
    .value-negative { color: #f87171; }

    .breakdown {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px dashed var(--border);
      padding-bottom: 8px;
    }

    .row:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
      margin: 0;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .primary-btn, .ghost-btn {
      border: 1px solid rgba(var(--accent-rgb), 0.4);
      background: rgba(var(--accent-rgb), 0.12);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(var(--accent-rgb), 0.18);
      background: rgba(var(--accent-rgb), 0.18);
    }

    .ghost-btn {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid var(--border);
      font-weight: 500;
    }

    .ghost-btn:hover {
      border-color: rgba(var(--accent-rgb), 0.5);
      color: var(--text);
    }

    .select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: #ffffff;
      color: var(--text);
      font-size: 15px;
      outline: none;
      transition: border 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .select:focus {
      border-color: rgba(var(--accent-rgb), 0.5);
      box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.18);
      background: #f8fafc;
    }

    .btn-small {
      padding: 8px 10px;
      font-size: 13px;
    }

    .sku-output {
      border: 1px dashed var(--border);
      border-radius: 12px;
      padding: 14px;
      background: var(--panel-2);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sku-text {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 0;
      max-height: 240px;
      overflow-y: auto;
    }

    .sku-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      background: var(--panel);
      font-size: 14px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text);
    }

    .checkbox-row input {
      accent-color: var(--accent);
      width: 16px;
      height: 16px;
    }

    .subnote {
      font-size: 12px;
      color: var(--muted);
    }

    .brand-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .brand-card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border 0.18s ease;
      color: var(--text);
      text-align: left;
    }

    .brand-card:hover {
      transform: translateY(-2px);
      border-color: rgba(var(--accent-rgb), 0.35);
      box-shadow: 0 12px 28px rgba(var(--accent-rgb), 0.18);
    }

    .brand-card img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      background: #ffffff;
      border-radius: 12px;
      padding: 10px;
      border: 1px solid var(--border);
    }

    .brand-card[data-brand="duo"] img {
      background: #ffffff;
      border-color: var(--border);
    }

    .brand-card h3 {
      margin: 0;
      font-size: 17px;
    }

    .brand-card p {
      margin: 4px 0 0 0;
      color: var(--muted);
      font-size: 13px;
    }

    @media (max-width: 1024px) {
      .calc-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 820px) {
      .layout { flex-direction: column; }
      .sidebar { width: 100%; flex-direction: row; align-items: center; }
      .menu { flex-direction: row; flex-wrap: wrap; }
      .content { min-height: 60vh; }
      .topbar { align-items: flex-start; gap: 12px; flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <img id="brand-logo" src="Logo.png" alt="Logo">
        <div class="brand-text">
          <span class="brand-title" id="brand-title">Selecione a empresa</span>
          <span class="brand-sub" id="brand-sub">Escolha um workspace</span>
        </div>
      </div>
      <nav class="menu" id="menu"></nav>
    </aside>

    <section class="content">
      <header class="topbar">
        <div id="topbar-intro">
          <h1 id="topbar-title">DASHBOARD</h1>
          <p id="topbar-subtitle">Escolha um app no menu e veja os detalhes aqui.</p>
        </div>
        <div class="actions">
          <button class="ghost-btn btn-small" id="switch-brand">Trocar empresa</button>
          <div class="status-pill" id="server-status">
            <span class="dot"></span>
            Checando servidor...
          </div>
        </div>
      </header>

      <div class="board">
        <div class="placeholder" id="board-content">
          Informacoes do app aparecerao aqui.
        </div>
      </div>
    </section>
  </div>

  <script>
    const brandConfigs = {
      efish: {
        title: "E-Fish ML",
        subtitle: "Workspace",
        logo: "Logo.png",
        apps: [
          { id: "app1", label: "Calculadora ML", render: renderApp1 },
          { id: "app2", label: "Gerador de SKU", render: renderApp2 },
          { id: "app3", label: "Gerador de EAN-13", render: renderApp3 }
        ]
      },
      duo: {
        title: "Duo International",
        subtitle: "Workspace",
        logo: "duo-realis-square-logo_1200x1140.avif",
        apps: [
          { id: "duo-catalog", label: "Catálogo Duo", render: renderDuoCatalog },
          { id: "duo-admin", label: "Gestão de Produtos", render: renderDuoAdmin },
          { id: "duo-ops", label: "Operações Duo", render: () => renderBrandPlaceholder("Operações Duo", "Adicione fluxos e relatórios da Duo International.") }
        ]
      }
    };

    let currentBrand = null;

    function applyBrandTheme(brandId) {
      document.body.classList.remove("brand-efish", "brand-duo");
      if (brandId === "efish") {
        document.body.classList.add("brand-efish");
      } else if (brandId === "duo") {
        document.body.classList.add("brand-duo");
      }
    }

    function updateBrandHeader(brand) {
      const logoEl = document.getElementById("brand-logo");
      const titleEl = document.getElementById("brand-title");
      const subEl = document.getElementById("brand-sub");
      if (logoEl && brand.logo) logoEl.src = brand.logo;
      if (logoEl) logoEl.alt = `Logo ${brand.title || "Empresa"}`;
      if (titleEl && brand.title) titleEl.textContent = brand.title;
      if (subEl && brand.subtitle) subEl.textContent = brand.subtitle;
    }

    function updateTopbar(title, subtitle) {
      const titleEl = document.getElementById("topbar-title");
      const subtitleEl = document.getElementById("topbar-subtitle");
      if (titleEl && title) titleEl.textContent = title;
      if (subtitleEl && subtitle) subtitleEl.textContent = subtitle;
    }

    function buildMenu(brandId) {
      const menu = document.getElementById("menu");
      if (!menu) return;
      menu.innerHTML = "";
      const brand = brandConfigs[brandId];
      if (!brand) return;
      brand.apps.forEach((app, index) => {
        const link = document.createElement("a");
        link.className = `menu-item${index === 0 ? " active" : ""}`;
        link.href = "#";
        link.textContent = app.label;
        link.setAttribute("data-app", app.id);
        link.addEventListener("click", (ev) => {
          ev.preventDefault();
          selectApp(app.id);
        });
        menu.appendChild(link);
      });
    }

    function renderBrandGate() {
      currentBrand = null;
      localStorage.removeItem("brandSelection");
      document.body.classList.add("brand-gate");
      updateTopbar("DASHBOARD", "Escolha uma empresa para continuar.");
      updateBrandHeader({ title: "Selecione a empresa", subtitle: "Escolha um workspace", logo: "Logo.png" });
      buildMenu(null);
      applyBrandTheme(null);

      const items = document.querySelectorAll(".menu-item");
      items.forEach((item) => item.classList.remove("active"));

      const board = document.getElementById("board-content");
      if (!board) return;
      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <p class="eyebrow">Bem-vindo</p>
              <h2 style="margin: 0 0 6px 0;">Selecione a empresa</h2>
              <p class="note">Escolha qual workspace abrir. Você pode trocar a qualquer momento.</p>
            </div>
          </div>
          <div class="brand-grid">
            <button class="brand-card" data-brand="efish">
              <img src="Logo.png" alt="Logo E-Fish ML">
              <div>
                <h3>E-Fish ML</h3>
                <p>Calculadora, SKU e EAN integrados.</p>
              </div>
            </button>
            <button class="brand-card" data-brand="duo">
              <img src="duo-realis-square-logo_1200x1140.avif" alt="Logo Duo Realis">
              <div>
                <h3>Duo International</h3>
                <p>Workspace separado para apps da Duo.</p>
              </div>
            </button>
          </div>
        </div>
      `;

      board.querySelectorAll("[data-brand]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const brandId = btn.getAttribute("data-brand");
          applyBrand(brandId);
        });
      });
    }

    function applyBrand(brandId) {
      const brand = brandConfigs[brandId];
      if (!brand) return;
      currentBrand = brandId;
      localStorage.setItem("brandSelection", brandId);
      document.body.classList.remove("brand-gate");
      updateTopbar("DASHBOARD", "Escolha um app no menu e veja os detalhes aqui.");
      applyBrandTheme(brandId);
      updateBrandHeader(brand);
      buildMenu(brandId);
      const firstApp = brand.apps[0];
      if (firstApp) {
        selectApp(firstApp.id);
      } else {
        renderBrandPlaceholder(brand.title, "Nenhum app cadastrado ainda.");
      }
    }

    function selectApp(appId) {
      const brand = brandConfigs[currentBrand];
      if (!brand) {
        renderBrandGate();
        return;
      }

      const items = document.querySelectorAll(".menu-item");
      items.forEach((item) => {
        const isActive = item.getAttribute("data-app") === appId;
        item.classList.toggle("active", isActive);
      });

      const app = brand.apps.find((entry) => entry.id === appId);
      if (app && typeof app.render === "function") {
        app.render();
      } else {
        renderBrandPlaceholder(appId, "Integrar conteúdo deste app.");
      }
    }

    function renderApp1() {
      const board = document.getElementById("board-content");
      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <h2 style="margin: 0 0 6px 0;">Calculadora Mercado Livre</h2>
              <p class="note">Simule custo, frete, comissão e imposto para ver lucro final e preço sugerido por margem.</p>
            </div>
            <div class="pill">Atualiza em tempo real</div>
          </div>

          <div class="calc-grid">
            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Entradas</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Preencha custos e percentuais para o anúncio.</p>
                </div>
                <span class="chip">Mercado Livre</span>
              </div>
              <div class="field-grid">
                <label class="field">
                  <span>Nome do produto (opcional)</span>
                  <input type="text" placeholder="ex.: exemplo" data-calc="productName" />
                </label>
                <label class="field">
                  <span>Custo base (R$)</span>
                  <input type="number" min="0" step="0.5" value="100" data-calc="baseCost" />
                </label>
                <label class="field">
                  <span>Frete (R$)</span>
                  <input type="number" min="0" step="0.5" value="20" data-calc="freight" />
                </label>
                <label class="field">
                  <span>IPI (%)</span>
                  <input type="number" min="0" step="0.1" value="0" data-calc="ipi" />
                </label>
                <label class="field">
                  <span>Imposto (%)</span>
                  <input type="number" min="0" step="0.1" value="10" data-calc="tax" />
                </label>
                <label class="field">
                  <span>Comissão ML (%)</span>
                  <input type="number" min="0" step="0.1" value="12" data-calc="commission" />
                </label>
                <label class="field">
                  <span>Tipo de anúncio</span>
                  <select class="select" data-calc="adType">
                    <option value="classic" selected>Clássico (12%)</option>
                    <option value="premium">Premium (16%)</option>
                    <option value="custom">Personalizado</option>
                  </select>
                </label>
                <label class="field">
                  <span>Preço de venda (R$)</span>
                  <input type="number" min="0" step="0.5" value="241" data-calc="price" />
                </label>
                <label class="field">
                  <span>Margem alvo (%)</span>
                  <input type="number" min="0" step="0.1" value="15" data-calc="targetMargin" />
                </label>
              </div>

              <div class="field calc-extra" style="gap: 10px;">
                <div class="checkbox-row">
                  <input type="checkbox" data-calc="below79" />
                  <span>Abaixo de R$79? Aplicar frete fixo de R$ 6,00.</span>
                </div>
              </div>

              <p class="hint">Baseado na fórmula do ML: Lucro = Venda - Frete - Comissão - Imposto - Custo (c/ IPI). Preço sugerido resolve a margem alvo com os percentuais.</p>
            </div>

            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Resumo da venda</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Lucro e margem final com detalhamento de comissão, imposto e custo.</p>
                </div>
              </div>
              <div class="stats">
                <div class="stat-card">
                  <p class="stat-label">Preço de venda</p>
                  <p class="stat-value" data-output="price">R$ 0,00</p>
                  <p class="note">Valor final que você informou.</p>
                </div>
                <div class="stat-card">
                  <p class="stat-label">Margem de lucro final</p>
                  <p class="stat-value" data-output="margin">0%</p>
                  <p class="note">Considera frete, comissão, imposto e custo (c/ IPI).</p>
                </div>
                <div class="stat-card">
                  <p class="stat-label">Lucro final</p>
                  <p class="stat-value" data-output="profit">R$ 0,00</p>
                  <p class="note" data-output="margin-label">Margem atual: 0%</p>
                </div>
              </div>

              <div class="breakdown">
                <div class="row"><span>Custo base</span><span data-output="base-cost">—</span></div>
                <div class="row"><span>Custo com IPI</span><span data-output="cost-ipi">—</span></div>
                <div class="row"><span>Frete</span><span data-output="freight">—</span></div>
                <div class="row"><span>Comissão</span><span data-output="commission">—</span></div>
                <div class="row"><span>Imposto</span><span data-output="tax">—</span></div>
                <div class="row"><span>Sobra (Venda - Frete - Comissão)</span><span data-output="left-no-tax">—</span></div>
                <div class="row"><span>Sobra - Imposto</span><span data-output="left-tax">—</span></div>
                <div class="row"><span>Lucro (Sobra - Custo c/ IPI)</span><span data-output="profit-line">—</span></div>
              </div>
              <p class="meta" data-output="suggestion">Preço sugerido para margem alvo: —</p>
            </div>
          </div>
        </div>
      `;
      initApp1Calculator();
    }

    function initApp1Calculator() {
      const board = document.getElementById("board-content");
      if (!board) return;

      const currency = new Intl.NumberFormat("pt-BR", {
        style: "currency",
        currency: "BRL",
        minimumFractionDigits: 2
      });

      const toPercent = (value) => `${value.toFixed(2)}%`;

      const readNumber = (name) => {
        const input = board.querySelector(`[data-calc="${name}"]`);
        if (!input) return 0;
        const parsed = parseFloat(String(input.value).replace(",", "."));
        return Number.isFinite(parsed) ? parsed : 0;
      };

      const setText = (name, value) => {
        const el = board.querySelector(`[data-output="${name}"]`);
        if (el) el.textContent = value;
      };

      const recalc = () => {
        const price = Math.max(0, readNumber("price"));
        const baseCost = Math.max(0, readNumber("baseCost"));
        const freightInput = Math.max(0, readNumber("freight"));
        const ipiPct = Math.max(0, readNumber("ipi"));
        const taxPct = Math.max(0, readNumber("tax"));
        const commissionPct = Math.max(0, readNumber("commission"));
        const targetMarginPct = Math.max(0, readNumber("targetMargin"));

        const below79 = Boolean(board.querySelector('[data-calc="below79"]')?.checked);
        const freight = below79 ? 6 : freightInput;
        const costWithIpi = baseCost * (1 + ipiPct / 100);
        const commissionValue = price * (commissionPct / 100);
        const taxValue = price * (taxPct / 100);

        const leftNoTax = price - freight - commissionValue;
        const leftWithTax = leftNoTax - taxValue;
        const profit = leftWithTax - costWithIpi;
        const margin = price > 0 ? (profit / price) * 100 : 0;

        const profitEl = board.querySelector('[data-output="profit"]');
        if (profitEl) {
          profitEl.classList.toggle("value-positive", profit >= 0);
          profitEl.classList.toggle("value-negative", profit < 0);
        }

        setText("price", currency.format(price));
        setText("margin", toPercent(margin));
        setText("margin-label", `Margem atual: ${toPercent(margin)}`);
        setText("profit", currency.format(profit));
        setText("base-cost", currency.format(baseCost));
        setText("cost-ipi", currency.format(costWithIpi));
        setText("freight", currency.format(freight));
        setText("commission", `${toPercent(commissionPct)} (${currency.format(commissionValue)})`);
        setText("tax", `${toPercent(taxPct)} (${currency.format(taxValue)})`);
        setText("left-no-tax", currency.format(leftNoTax));
        setText("left-tax", currency.format(leftWithTax));
        setText("profit-line", currency.format(profit));

        const target = targetMarginPct / 100;
        const denominator = 1 - commissionPct / 100 - taxPct / 100 - target;
        const suggestedPrice = denominator > 0 ? (freight + costWithIpi) / denominator : null;
        const suggestionEl = board.querySelector('[data-output="suggestion"]');

        if (suggestedPrice !== null && Number.isFinite(suggestedPrice)) {
          if (suggestionEl) suggestionEl.textContent = `Preço sugerido para ${toPercent(targetMarginPct)} de margem: ${currency.format(suggestedPrice)}.`;
        } else if (suggestionEl) {
          suggestionEl.textContent = "Margem alvo inalcançável: ajuste comissão, imposto ou custos.";
        }
      };

      const adTypeSelect = board.querySelector('[data-calc="adType"]');
      const commissionInput = board.querySelector('[data-calc="commission"]');

      if (adTypeSelect && commissionInput) {
        adTypeSelect.addEventListener("change", () => {
          if (adTypeSelect.value === "classic") commissionInput.value = 12;
          else if (adTypeSelect.value === "premium") commissionInput.value = 16;
        });
      }

      board.querySelectorAll("[data-calc]").forEach((input) => {
        input.addEventListener("input", recalc);
        input.addEventListener("change", recalc);
      });

      recalc();
    }

    function renderApp2() {
      const board = document.getElementById("board-content");
      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <h2 style="margin: 0 0 6px 0;">Gerador de SKU</h2>
              <p class="note">Monte SKUs padronizados com prefixo, categoria, produto, variação e sequencial. Inclua data e sufixo randômico para evitar duplicidade.</p>
            </div>
            <div class="pill">Formato consistente e copiável</div>
          </div>

          <div class="calc-grid">
            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Configuração</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Defina os blocos que compõem o SKU.</p>
                </div>
                <span class="chip">SKU</span>
              </div>
              <div class="field-grid">
                <label class="field">
                  <span>Prefixo</span>
                  <input type="text" value="EFM" data-sku-input="prefix" />
                </label>
                <label class="field">
                  <span>Categoria</span>
                  <input type="text" value="PEIXE" data-sku-input="category" />
                </label>
                <label class="field">
                  <span>Produto/base</span>
                  <input type="text" value="TILAPIA" data-sku-input="product" />
                </label>
                <label class="field">
                  <span>Variação</span>
                  <input type="text" value="FRESCA" data-sku-input="variant" />
                </label>
                <label class="field">
                  <span>Sequencial inicial</span>
                  <input type="number" min="0" step="1" value="1001" data-sku-input="sequence" />
                </label>
                <label class="field">
                  <span>Dígitos do sequencial</span>
                  <input type="number" min="2" max="8" step="1" value="4" data-sku-input="digits" />
                </label>
              </div>

              <div class="field-grid">
                <label class="field">
                  <span>Separador</span>
                  <input type="text" value="-" maxlength="1" data-sku-input="separator" />
                </label>
                <label class="field">
                  <span>Sufixo randômico (2 chars)</span>
                  <input type="text" value="" placeholder="Deixe vazio para sortear" data-sku-input="suffix" />
                </label>
              </div>

              <div class="field" style="gap: 10px;">
                <div class="checkbox-row">
                  <input type="checkbox" data-sku-input="useDate" checked />
                  <span>Incluir data (YYMM)</span>
                </div>
                <div class="checkbox-row">
                  <input type="checkbox" data-sku-input="autoIncrement" checked />
                  <span>Incrementar sequencial automaticamente</span>
                </div>
                <div class="checkbox-row">
                  <input type="checkbox" data-sku-input="randomSuffix" checked />
                  <span>Gerar sufixo randômico (quando campo vazio)</span>
                </div>
              </div>
              <p class="hint">Sugestão: use blocos curtos e estáveis (ex.: prefixo da marca, categoria e variante) e um sequencial com 4–6 dígitos.</p>
            </div>

            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Saída</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Gere e copie SKUs prontos para colar em planilhas ou ERPs.</p>
                </div>
                <div class="actions">
                  <button class="primary-btn" data-sku-action="generate">Gerar SKU</button>
                  <button class="ghost-btn" data-sku-action="copy-last">Copiar último</button>
                  <button class="ghost-btn" data-sku-action="copy-all">Copiar todos</button>
                </div>
              </div>

              <div class="sku-output">
                <span class="eyebrow" style="margin:0;">Último SKU</span>
                <div class="sku-text" data-output="latest-sku">—</div>
                <p class="note" data-output="latest-hint">Clique em "Gerar SKU" para começar.</p>
              </div>

              <div class="list" data-output="sku-list"></div>
              <p class="meta">Formato padrão: PREFIXO-CATEGORIA-PRODUTO-VARIACAO-YYMM-SEQUENCIAL-SUFIXO (ex.: EFM-PEIXE-TILAPIA-FRESCA-2409-1001-R2).</p>
            </div>
          </div>
        </div>
      `;
      initSkuGenerator();
    }

    function initSkuGenerator() {
      const board = document.getElementById("board-content");
      if (!board) return;

      const inputs = (name) => board.querySelector(`[data-sku-input="${name}"]`);
      const output = (name) => board.querySelector(`[data-output="${name}"]`);
      const listEl = output("sku-list");
      const latestEl = output("latest-sku");
      const hintEl = output("latest-hint");

      const skus = [];

      const sanitize = (value) => (value || "").toUpperCase().replace(/[^A-Z0-9]/g, "");
      const pad = (num, size) => String(Math.max(0, Math.floor(num))).padStart(size, "0");
      const randomSuffix = () => {
        const chars = "ABCDEFGHJKMNPQRSTUVWXYZ23456789";
        return Array.from({ length: 2 }, () => chars[Math.floor(Math.random() * chars.length)]).join("");
      };

      const buildSku = () => {
        const prefix = sanitize(inputs("prefix")?.value);
        const category = sanitize(inputs("category")?.value);
        const product = sanitize(inputs("product")?.value);
        const variant = sanitize(inputs("variant")?.value);
        const separator = (inputs("separator")?.value || "-").substring(0, 1) || "-";
        const digits = Math.min(8, Math.max(2, parseInt(inputs("digits")?.value, 10) || 4));
        const seqInput = inputs("sequence");
        const sequenceValue = Math.max(0, parseInt(seqInput?.value, 10) || 0);
        const useDate = Boolean(inputs("useDate")?.checked);
        const autoIncrement = Boolean(inputs("autoIncrement")?.checked);
        const useRandomSuffix = Boolean(inputs("randomSuffix")?.checked);
        const manualSuffix = sanitize(inputs("suffix")?.value);

        const segments = [prefix, category, product, variant].filter(Boolean);

        if (useDate) {
          const now = new Date();
          const yy = String(now.getFullYear()).slice(-2);
          const mm = String(now.getMonth() + 1).padStart(2, "0");
          segments.push(`${yy}${mm}`);
        }

        segments.push(pad(sequenceValue, digits));

        const suffix = manualSuffix || (useRandomSuffix ? randomSuffix() : "");
        if (suffix) segments.push(suffix);

        const sku = segments.join(separator);

        if (autoIncrement && seqInput) {
          seqInput.value = sequenceValue + 1;
        }

        return sku;
      };

      const renderList = () => {
        if (!listEl) return;
        if (!skus.length) {
          listEl.innerHTML = '<p class="note" style="margin:0;">Nenhum SKU gerado ainda.</p>';
          return;
        }

        const startIndex = Math.max(0, skus.length - 12);
        const recent = skus
          .slice(startIndex)
          .map((sku, idx) => ({ sku, index: startIndex + idx }))
          .reverse();

        listEl.innerHTML = recent
          .map(({ sku, index }) => `
            <div class="sku-line">
              <span>${sku}</span>
              <div class="actions">
                <button class="ghost-btn btn-small" data-copy="${sku}">Copiar</button>
                <button class="ghost-btn btn-small" data-delete-sku="${index}">Excluir</button>
              </div>
            </div>
          `)
          .join("");

        listEl.querySelectorAll("[data-copy]").forEach((btn) => {
          btn.addEventListener("click", () => copyText(btn.getAttribute("data-copy") || ""));
        });

        listEl.querySelectorAll("[data-delete-sku]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const index = Number(btn.getAttribute("data-delete-sku"));
            if (Number.isNaN(index)) return;
            skus.splice(index, 1);
            renderList();
          });
        });
      };

      const copyText = async (text) => {
        if (!text) return;
        try {
          await navigator.clipboard.writeText(text);
          if (hintEl) hintEl.textContent = "Copiado para a área de transferência.";
        } catch (_) {
          const area = document.createElement("textarea");
          area.value = text;
          document.body.appendChild(area);
          area.select();
          document.execCommand("copy");
          document.body.removeChild(area);
          if (hintEl) hintEl.textContent = "Copiado (fallback).";
        }
      };

      const generate = () => {
        const sku = buildSku();
        skus.push(sku);
        if (skus.length > 100) skus.shift();

        if (latestEl) latestEl.textContent = sku;
        if (hintEl) hintEl.textContent = "SKU pronto. Clique para copiar ou gere o próximo.";
        renderList();
      };

      board.querySelectorAll("[data-sku-action]").forEach((btn) => {
        const action = btn.getAttribute("data-sku-action");
        if (action === "generate") {
          btn.addEventListener("click", generate);
        } else if (action === "copy-last") {
          btn.addEventListener("click", () => copyText(latestEl?.textContent || ""));
        } else if (action === "copy-all") {
          btn.addEventListener("click", () => copyText(skus.join("\n")));
        }
      });

      generate();
    }

    function renderApp3() {
      const board = document.getElementById("board-content");
      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <h2 style="margin: 0 0 6px 0;">Gerador de EAN-13</h2>
              <p class="note">Monte códigos EAN-13 válidos com dígito verificador automático. Defina prefixo, empresa e produto ou deixe a ferramenta sortear.</p>
            </div>
            <div class="pill">EAN com dígito verificador</div>
          </div>

          <div class="calc-grid">
            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Configuração</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Preencha blocos numéricos; campos vazios são completados automaticamente.</p>
                </div>
                <span class="chip">EAN-13</span>
              </div>

              <div class="field-grid">
                <label class="field">
                  <span>Prefixo GS1 (3 dígitos)</span>
                  <input type="text" value="789" maxlength="3" data-ean-input="prefix" />
                </label>
                <label class="field">
                  <span>Código da empresa (4 dígitos)</span>
                  <input type="text" value="1234" maxlength="4" data-ean-input="company" />
                </label>
                <label class="field">
                  <span>Código do produto (5 dígitos)</span>
                  <input type="text" value="56789" maxlength="5" data-ean-input="product" />
                </label>
                <label class="field">
                  <span>Quantidade para gerar</span>
                  <input type="number" min="1" max="50" step="1" value="5" data-ean-input="count" />
                </label>
              </div>

              <div class="field" style="gap: 10px;">
                <div class="checkbox-row">
                  <input type="checkbox" data-ean-input="randomFill" checked />
                  <span>Preencher automaticamente se faltar dígitos</span>
                </div>
                <div class="checkbox-row">
                  <input type="checkbox" data-ean-input="incrementProduct" checked />
                  <span>Incrementar produto a cada EAN gerado</span>
                </div>
              </div>
              <p class="hint">O EAN-13 precisa de 12 dígitos base + 1 dígito verificador. Usamos o algoritmo oficial de módulo 10.</p>
            </div>

            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Saída</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Gere e copie EANs válidos.</p>
                </div>
                <div class="actions">
                  <button class="primary-btn" data-ean-action="generate">Gerar EAN</button>
                  <button class="ghost-btn" data-ean-action="copy-last">Copiar último</button>
                  <button class="ghost-btn" data-ean-action="copy-all">Copiar todos</button>
                </div>
              </div>

              <div class="sku-output">
                <span class="eyebrow" style="margin:0;">Último EAN</span>
                <div class="sku-text" data-output="latest-ean">—</div>
                <p class="note" data-output="latest-ean-hint">Clique em "Gerar EAN" para começar.</p>
              </div>

              <div class="list" data-output="ean-list"></div>
              <p class="meta">Formato: 12 dígitos base + dígito verificador. Ex.: 7891234567892.</p>
            </div>
          </div>
        </div>
      `;
      initEanGenerator();
    }

    function initEanGenerator() {
      const board = document.getElementById("board-content");
      if (!board) return;

      const getInput = (name) => board.querySelector(`[data-ean-input="${name}"]`);
      const latestEl = board.querySelector('[data-output="latest-ean"]');
      const hintEl = board.querySelector('[data-output="latest-ean-hint"]');
      const listEl = board.querySelector('[data-output="ean-list"]');
      const eans = [];

      const digitsOnly = (value) => (value || "").replace(/\D/g, "");
      const randDigits = (len) => Array.from({ length: len }, () => Math.floor(Math.random() * 10)).join("");
      const padOrFill = (value, len, allowRandom) => {
        const clean = digitsOnly(value).slice(0, len);
        if (clean.length === len) return clean;
        if (allowRandom) return (clean + randDigits(len)).slice(0, len);
        return clean.padEnd(len, "0").slice(0, len);
      };

      const calcCheckDigit = (base12) => {
        const digits = base12.split("").map((d) => parseInt(d, 10));
        const sum = digits.reduce((acc, digit, idx) => {
          const isEvenPosition = (idx + 1) % 2 === 0;
          return acc + digit * (isEvenPosition ? 3 : 1);
        }, 0);
        return (10 - (sum % 10)) % 10;
      };

      const buildEans = () => {
        const allowRandom = Boolean(getInput("randomFill")?.checked);
        const incrementProduct = Boolean(getInput("incrementProduct")?.checked);
        const count = Math.min(50, Math.max(1, parseInt(getInput("count")?.value, 10) || 1));

        const prefix = padOrFill(getInput("prefix")?.value || "", 3, allowRandom);
        const company = padOrFill(getInput("company")?.value || "", 4, allowRandom);
        const productBaseRaw = padOrFill(getInput("product")?.value || "", 5, allowRandom);
        const productBase = parseInt(productBaseRaw, 10) || 0;

        const generated = [];
        for (let i = 0; i < count; i += 1) {
          const productNumber = incrementProduct ? productBase + i : productBase;
          const product = String(productNumber).padStart(5, "0").slice(0, 5);
          const base12 = `${prefix}${company}${product}`.slice(0, 12);
          const check = calcCheckDigit(base12);
          generated.push(`${base12}${check}`);
        }
        return generated;
      };

      const copyText = async (text) => {
        if (!text) return;
        try {
          await navigator.clipboard.writeText(text);
          if (hintEl) hintEl.textContent = "Copiado para a área de transferência.";
        } catch (_) {
          const area = document.createElement("textarea");
          area.value = text;
          document.body.appendChild(area);
          area.select();
          document.execCommand("copy");
          document.body.removeChild(area);
          if (hintEl) hintEl.textContent = "Copiado (fallback).";
        }
      };

      const renderList = () => {
        if (!listEl) return;
        if (!eans.length) {
          listEl.innerHTML = '<p class="note" style="margin:0;">Nenhum EAN gerado ainda.</p>';
          return;
        }

        const startIndex = Math.max(0, eans.length - 20);
        const recent = eans
          .slice(startIndex)
          .map((ean, idx) => ({ ean, index: startIndex + idx }))
          .reverse();

        listEl.innerHTML = recent
          .map(({ ean, index }) => `
            <div class="sku-line">
              <span>${ean}</span>
              <div class="actions">
                <button class="ghost-btn btn-small" data-copy="${ean}">Copiar</button>
                <button class="ghost-btn btn-small" data-delete-ean="${index}">Excluir</button>
              </div>
            </div>
          `)
          .join("");

        listEl.querySelectorAll("[data-copy]").forEach((btn) => {
          btn.addEventListener("click", () => copyText(btn.getAttribute("data-copy") || ""));
        });

        listEl.querySelectorAll("[data-delete-ean]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const index = Number(btn.getAttribute("data-delete-ean"));
            if (Number.isNaN(index)) return;
            eans.splice(index, 1);
            renderList();
          });
        });
      };

      const generate = () => {
        const generated = buildEans();
        generated.forEach((ean) => eans.push(ean));
        if (eans.length > 200) eans.splice(0, eans.length - 200);

        if (latestEl) latestEl.textContent = generated[generated.length - 1] || "—";
        if (hintEl) hintEl.textContent = `Gerados ${generated.length} EAN(s).`;
        renderList();
      };

      board.querySelectorAll("[data-ean-action]").forEach((btn) => {
        const action = btn.getAttribute("data-ean-action");
        if (action === "generate") {
          btn.addEventListener("click", generate);
        } else if (action === "copy-last") {
          btn.addEventListener("click", () => copyText(latestEl?.textContent || ""));
        } else if (action === "copy-all") {
          btn.addEventListener("click", () => copyText(eans.join("\n")));
        }
      });

      renderList();
      generate();
    }

    function renderDuoCatalog() {
      const board = document.getElementById("board-content");
      if (!board) return;
      const catalogUrl = "/duo-catalog";

      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <h2 style="margin: 0 0 6px 0;">Catálogo Duo</h2>
              <p class="note">Abra o catálogo de produtos em nova guia. Usa o build em <code>MVP/dist</code>.</p>
            </div>
            <div class="pill">Abre em nova aba</div>
          </div>
          <a class="cta" href="${catalogUrl}" target="_blank" rel="noopener" data-duo-catalog-cta>Abrir catálogo da Duo</a>
          <p class="note">Para atualizar o catálogo, rode <code>npm run build</code> dentro de <code>MVP</code>; o link segue apontando para o build mais recente.</p>
        </div>
      `;

      const cta = board.querySelector("[data-duo-catalog-cta]");
      if (cta) {
        cta.addEventListener("click", (ev) => {
          ev.preventDefault();
          window.open(catalogUrl, "_blank", "noopener");
        });
      }
    }

    function renderDuoAdmin() {
      const board = document.getElementById("board-content");
      if (!board) return;

      const localKey = "catalog-local-products";

      const readLocal = () => {
        try {
          const raw = localStorage.getItem(localKey);
          return raw ? JSON.parse(raw) : [];
        } catch {
          return [];
        }
      };

      const writeLocal = (products) => {
        try {
          localStorage.setItem(localKey, JSON.stringify(products));
        } catch {
          // ignore
        }
      };

      const renderList = () => {
        const list = board.querySelector("[data-admin-list]");
        if (!list) return;
        const products = readLocal();
        if (!products.length) {
          list.innerHTML = '<p class="note" style="margin:0;">Nenhum produto local cadastrado. Adicione usando o formulário ao lado.</p>';
          return;
        }
        list.innerHTML = products
          .map(
            (p) => `
            <div class="sku-line">
              <span>${p.nome} — R$ ${Number(p.preco || 0).toFixed(2)}</span>
              <div class="actions">
                <button class="ghost-btn btn-small" data-admin-remove="${p.id}">Remover</button>
              </div>
            </div>
          `
          )
          .join("");
        list.querySelectorAll("[data-admin-remove]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-admin-remove");
            const updated = readLocal().filter((item) => item.id !== id);
            writeLocal(updated);
            renderList();
          });
        });
      };

      const submitForm = (event) => {
        event.preventDefault();
        const form = event.currentTarget;
        const data = new FormData(form);
        const nome = data.get("nome")?.toString().trim();
        const preco = parseFloat(data.get("preco")?.toString().replace(",", ".") || "0");
        if (!nome || Number.isNaN(preco) || preco <= 0) {
          alert("Preencha nome e preço válido.");
          return;
        }
        const novo = {
          id: `local-${Date.now()}`,
          nome,
          descricao: data.get("descricao")?.toString() || "",
          preco,
          categoria: data.get("categoria")?.toString() || "Pesca",
          imagem: data.get("imagem")?.toString() || "",
          imagens: (data.get("imagens")?.toString() || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean),
        };
        const current = readLocal();
        current.push(novo);
        writeLocal(current);
        form.reset();
        renderList();
      };

      board.innerHTML = `
        <div class="board-card">
          <div class="app-header">
            <div>
              <h2 style="margin: 0 0 6px 0;">Gestão de Produtos (Duo)</h2>
              <p class="note">Adicione ou remova itens do catálogo local. Útil para testes rápidos sem backend.</p>
            </div>
            <div class="pill">Somente Duo / Admin</div>
          </div>

          <div class="calc-grid">
            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Adicionar produto</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Preencha os campos e salve. Caminhos locais: use /pre_order_imagens/arquivo.png.</p>
                </div>
              </div>
              <form class="field-grid" data-admin-form>
                <label class="field">
                  <span>Nome</span>
                  <input name="nome" type="text" required />
                </label>
                <label class="field">
                  <span>Preço (R$)</span>
                  <input name="preco" type="number" step="0.01" min="0" required />
                </label>
                <label class="field">
                  <span>Categoria</span>
                  <input name="categoria" type="text" value="Pesca" />
                </label>
                <label class="field">
                  <span>Imagem (URL)</span>
                  <input name="imagem" type="text" placeholder="/pre_order_imagens/prd-xxx.png" />
                </label>
                <label class="field">
                  <span>Imagens adicionais (CSV)</span>
                  <input name="imagens" type="text" placeholder="img1.png, img2.png" />
                </label>
                <label class="field" style="grid-column: 1 / -1;">
                  <span>Descrição</span>
                  <input name="descricao" type="text" />
                </label>
                <div style="grid-column: 1 / -1;">
                  <button class="primary-btn" type="submit">Salvar produto</button>
                </div>
              </form>
            </div>

            <div class="panel-card">
              <div class="panel-title">
                <div>
                  <h3 style="margin: 0;">Produtos locais</h3>
                  <p class="note" style="margin: 4px 0 0 0;">Itens adicionados ficam disponíveis no catálogo (fallback local).</p>
                </div>
              </div>
              <div class="list" data-admin-list></div>
            </div>
          </div>
        </div>
      `;

      const form = board.querySelector("[data-admin-form]");
      if (form) {
        form.addEventListener("submit", submitForm);
      }
      renderList();
    }

    function renderPlaceholder(name) {
      const board = document.getElementById("board-content");
      board.innerHTML = `
        <div class="board-card">
          <h2 style="margin: 0 0 8px 0;">${name}</h2>
          <p class="note">Integrar conteudo deste app aqui.</p>
        </div>
      `;
    }

    function renderBrandPlaceholder(title, note = "Integrar conteudo deste app aqui.") {
      const board = document.getElementById("board-content");
      board.innerHTML = `
        <div class="board-card">
          <h2 style="margin: 0 0 8px 0;">${title}</h2>
          <p class="note">${note}</p>
        </div>
      `;
    }

    async function fetchStatus() {
      const statusEl = document.getElementById("server-status");
      if (!statusEl) return;
      try {
        const response = await fetch("/api/status");
        if (!response.ok) {
          throw new Error("Resposta invalida do servidor");
        }
        const data = await response.json();
        statusEl.classList.remove("offline");
        statusEl.classList.add("online");
        statusEl.innerHTML = '<span class="dot"></span>' + (data.message || "Servidor online");
      } catch (error) {
        statusEl.classList.remove("online");
        statusEl.classList.add("offline");
        statusEl.innerHTML = '<span class="dot offline"></span>Servidor indisponivel';
      }
    }

    const switchBrandBtn = document.getElementById("switch-brand");
    if (switchBrandBtn) {
      switchBrandBtn.addEventListener("click", () => renderBrandGate());
    }

    function bootstrapWorkspace() {
      const stored = localStorage.getItem("brandSelection");
      if (stored && brandConfigs[stored]) {
        applyBrand(stored);
      } else {
        renderBrandGate();
      }
    }

    fetchStatus();
    bootstrapWorkspace();
  </script>
</body>
</html>
